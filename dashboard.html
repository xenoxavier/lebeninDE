<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Leben in Deutschland</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="quiz-enhancements.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body>
    <div class="loading-screen">
        <div class="loading-animation">
            <div class="cube-container">
                <div class="cube">
                    <div class="face front"></div>
                    <div class="face back"></div>
                    <div class="face right"></div>
                    <div class="face left"></div>
                    <div class="face top"></div>
                    <div class="face bottom"></div>
                </div>
            </div>
            <p>Leben in Deutschland wird geladen...</p>
        </div>
    </div>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <div class="brand-icon">üá©üá™</div>
                <div class="brand-text">
                    <h1>LebenDE</h1>
                    <span>Citizenship Test</span>
                </div>
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                <li class="nav-item"><a href="#dashboard" class="nav-link">Dashboard</a></li>
            </ul>
            <div class="nav-actions">
            </div>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <main>
        <section id="dashboard" class="dashboard-section">
            <div class="container">
                <div class="dashboard-header">
                    <h2 class="section-title">Personal Dashboard</h2>
                    <p class="section-subtitle">Track your learning progress and achievements</p>
                </div>
                
                <!-- Dashboard Layout with Sidebar -->
                <div class="dashboard-layout">
                    <!-- Left Sidebar - User Profile -->
                    <div class="dashboard-sidebar">
                        <div class="user-profile-card">
                            <div class="profile-avatar">
                                <div class="avatar-container">
                                    <div class="avatar-image" id="user-avatar">üá©üá™</div>
                                    <button class="avatar-edit-btn" id="avatar-edit">‚úèÔ∏è</button>
                                </div>
                            </div>
                            <div class="profile-info">
                                <h3 class="profile-name" id="profile-name">Willkommen zur√ºck!</h3>
                                <p class="profile-subtitle">German Citizenship Candidate</p>
                                <div class="profile-stats">
                                    <div class="profile-stat">
                                        <span class="stat-number" id="profile-total-sessions">0</span>
                                        <span class="stat-label">Sessions</span>
                                    </div>
                                    <div class="profile-stat">
                                        <span class="stat-number" id="profile-study-time">0h</span>
                                        <span class="stat-label">Study Time</span>
                                    </div>
                                    <div class="profile-stat">
                                        <span class="stat-number" id="profile-success-rate">0%</span>
                                        <span class="stat-label">Success Rate</span>
                                    </div>
                                </div>
                                <button class="edit-profile-btn" id="edit-profile">Edit Profile</button>
                            </div>
                        </div>
                        
                        <!-- Quick Quiz Start Buttons - Separate Card -->
                        <div class="quiz-start-card">
                            <div class="quiz-start-header">
                                <h4>Start Quiz</h4>
                                <p>Choose your practice mode</p>
                            </div>
                            <div class="quiz-start-buttons">
                                <button class="quiz-start-btn" onclick="window.location.href='quiz.html?mode=practice'">
                                    <div class="quiz-btn-icon">üìö</div>
                                    <div class="quiz-btn-content">
                                        <span class="quiz-btn-title">Practice</span>
                                        <span class="quiz-btn-subtitle">All Questions</span>
                                    </div>
                                </button>
                                <button class="quiz-start-btn" onclick="window.location.href='exam-simulation.html'">
                                    <div class="quiz-btn-icon">üìù</div>
                                    <div class="quiz-btn-content">
                                        <span class="quiz-btn-title">Exam Simulation</span>
                                        <span class="quiz-btn-subtitle">33 Questions, 60 min</span>
                                    </div>
                                </button>
                                <button class="quiz-start-btn" onclick="showBundeslandSelector()">
                                    <div class="quiz-btn-icon">üèõÔ∏è</div>
                                    <div class="quiz-btn-content">
                                        <span class="quiz-btn-title">Bundesland</span>
                                        <span class="quiz-btn-subtitle">State-Specific</span>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Content - Dashboard Grid -->
                    <div class="dashboard-content">
                        <div class="dashboard-grid">
                    <!-- Learning Progress Card -->
                    <div class="dashboard-card progress-card">
                        <div class="card-header">
                            <div class="card-icon">üìä</div>
                            <h3>Learning Progress</h3>
                        </div>
                        <div class="progress-overview">
                            <div class="circular-progress">
                                <svg class="progress-circle" viewBox="0 0 120 120">
                                    <circle cx="60" cy="60" r="50" stroke="#e0e0e0" stroke-width="8" fill="none"/>
                                    <circle cx="60" cy="60" r="50" stroke="#4CAF50" stroke-width="8" fill="none" 
                                            stroke-dasharray="314.16" stroke-dashoffset="314.16" 
                                            id="dashboard-progress-circle" class="progress-stroke"/>
                                </svg>
                                <div class="progress-center">
                                    <span class="progress-percentage" id="dashboard-progress-text">0%</span>
                                    <span class="progress-label">Complete</span>
                                </div>
                            </div>
                            <div class="progress-details">
                                <div class="progress-item">
                                    <span class="progress-dot correct"></span>
                                    <span>Correct: <strong id="dashboard-correct">0</strong></span>
                                </div>
                                <div class="progress-item">
                                    <span class="progress-dot incorrect"></span>
                                    <span>Incorrect: <strong id="dashboard-incorrect">0</strong></span>
                                </div>
                                <div class="progress-item">
                                    <span class="progress-dot remaining"></span>
                                    <span>Remaining: <strong id="dashboard-remaining">10</strong></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity Card -->
                    <div class="dashboard-card activity-card">
                        <div class="card-header">
                            <div class="card-icon">üìà</div>
                            <h3>Recent Activity</h3>
                        </div>
                        <div class="activity-list" id="recent-activity">
                            <div class="activity-item empty">
                                <div class="activity-icon">üéØ</div>
                                <div class="activity-content">
                                    <p>Start your first quiz to see activity here!</p>
                                    <span class="activity-time">No activity yet</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Study Streak Card -->
                    <div class="dashboard-card streak-card">
                        <div class="card-header">
                            <div class="card-icon">üî•</div>
                            <h3>Study Streak</h3>
                        </div>
                        <div class="streak-content">
                            <div class="streak-number" id="current-streak">0</div>
                            <div class="streak-label">Days in a row</div>
                            <div class="streak-calendar">
                                <div class="calendar-week" id="streak-calendar">
                                    <!-- Calendar dots will be generated by JS -->
                                </div>
                            </div>
                            <p class="streak-motivation" id="streak-message">Start studying to build your streak!</p>
                        </div>
                    </div>

                    <!-- Weak Areas Card -->
                    <div class="dashboard-card weak-areas-card">
                        <div class="card-header">
                            <div class="card-icon">üìö</div>
                            <h3>Focus Areas</h3>
                        </div>
                        <div class="weak-areas-content">
                            <div class="areas-list" id="weak-areas-list">
                                <div class="area-item">
                                    <div class="area-info">
                                        <span class="area-name">Politik in der Demokratie</span>
                                        <div class="area-progress">
                                            <div class="area-bar">
                                                <div class="area-fill" style="width: 60%"></div>
                                            </div>
                                            <span class="area-percentage">60%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="area-item">
                                    <div class="area-info">
                                        <span class="area-name">Geschichte und Verantwortung</span>
                                        <div class="area-progress">
                                            <div class="area-bar">
                                                <div class="area-fill" style="width: 45%"></div>
                                            </div>
                                            <span class="area-percentage">45%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="area-item">
                                    <div class="area-info">
                                        <span class="area-name">Mensch und Gesellschaft</span>
                                        <div class="area-progress">
                                            <div class="area-bar">
                                                <div class="area-fill" style="width: 80%"></div>
                                            </div>
                                            <span class="area-percentage">80%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button class="focus-study-btn">Practice Weak Areas</button>
                        </div>
                    </div>

                    <!-- Quick Stats Card -->
                    <div class="dashboard-card stats-card">
                        <div class="card-header">
                            <div class="card-icon">‚ö°</div>
                            <h3>Quick Stats</h3>
                        </div>
                        <div class="quick-stats">
                            <div class="quick-stat">
                                <div class="stat-icon">üéØ</div>
                                <div class="stat-info">
                                    <span class="stat-number" id="total-questions-answered">0</span>
                                    <span class="stat-label">Questions Answered</span>
                                </div>
                            </div>
                            <div class="quick-stat">
                                <div class="stat-icon">‚è±Ô∏è</div>
                                <div class="stat-info">
                                    <span class="stat-number" id="average-time">0s</span>
                                    <span class="stat-label">Avg. Answer Time</span>
                                </div>
                            </div>
                            <div class="quick-stat">
                                <div class="stat-icon">üèÜ</div>
                                <div class="stat-info">
                                    <span class="stat-number" id="best-streak">0</span>
                                    <span class="stat-label">Best Streak</span>
                                </div>
                            </div>
                            <div class="quick-stat">
                                <div class="stat-icon">üìÖ</div>
                                <div class="stat-info">
                                    <span class="stat-number" id="days-studied">0</span>
                                    <span class="stat-label">Days Studied</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Exam History -->
                    <div class="dashboard-card exam-history-card">
                        <div class="card-header">
                            <div class="card-icon">üìã</div>
                            <h3>Exam History</h3>
                        </div>
                        <div class="exam-history-content" id="exam-history-list">
                            <div class="exam-history-empty">
                                <p>No exam attempts yet. Take your first exam simulation!</p>
                            </div>
                        </div>
                    </div>


                </div>

                </div> <!-- Close dashboard-content -->
                </div> <!-- Close dashboard-layout -->

            </div>
        </section>


    </main>

    <!-- Bundesland Selector Modal -->
    <div id="bundesland-modal" class="bundesland-modal" style="display: none;">
        <div class="bundesland-modal-overlay" onclick="closeBundeslandSelector()"></div>
        <div class="bundesland-modal-content">
            <div class="bundesland-modal-header">
                <h3>Choose Your Bundesland</h3>
                <p>Select your German state for specific questions</p>
                <button class="close-btn" onclick="closeBundeslandSelector()">√ó</button>
            </div>
            <div class="bundesland-grid">
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Baden-W√ºrttemberg')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Baden-W√ºrttemberg</span>
                        <span class="bundesland-capital">Stuttgart</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Bayern')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Bayern</span>
                        <span class="bundesland-capital">M√ºnchen</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Berlin')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Berlin</span>
                        <span class="bundesland-capital">Berlin</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Brandenburg')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Brandenburg</span>
                        <span class="bundesland-capital">Potsdam</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Bremen')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Bremen</span>
                        <span class="bundesland-capital">Bremen</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Hamburg')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Hamburg</span>
                        <span class="bundesland-capital">Hamburg</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Hessen')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Hessen</span>
                        <span class="bundesland-capital">Wiesbaden</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Mecklenburg-Vorpommern')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Mecklenburg-Vorpommern</span>
                        <span class="bundesland-capital">Schwerin</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Niedersachsen')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Niedersachsen</span>
                        <span class="bundesland-capital">Hannover</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Nordrhein-Westfalen')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Nordrhein-Westfalen</span>
                        <span class="bundesland-capital">D√ºsseldorf</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Rheinland-Pfalz')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Rheinland-Pfalz</span>
                        <span class="bundesland-capital">Mainz</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Saarland')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Saarland</span>
                        <span class="bundesland-capital">Saarbr√ºcken</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Sachsen')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Sachsen</span>
                        <span class="bundesland-capital">Dresden</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Sachsen-Anhalt')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Sachsen-Anhalt</span>
                        <span class="bundesland-capital">Magdeburg</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Schleswig-Holstein')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Schleswig-Holstein</span>
                        <span class="bundesland-capital">Kiel</span>
                    </div>
                </button>
                <button class="bundesland-btn" onclick="startBundeslandQuiz('Th√ºringen')">
                    <div class="bundesland-info">
                        <span class="bundesland-name">Th√ºringen</span>
                        <span class="bundesland-capital">Erfurt</span>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-brand">
                        <div class="brand-icon">üá©üá™</div>
                        <div class="brand-text">
                            <h3>LebenDE</h3>
                            <p>Your path to German citizenship</p>
                        </div>
                    </div>
                    <p>Prepare for the Leben in Deutschland test with our comprehensive platform trusted by thousands of students.</p>
                </div>
                
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="#dashboard">Dashboard</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="#">Study Guide</a></li>
                        <li><a href="#">Official Questions</a></li>
                        <li><a href="#">Test Centers</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Contact</h4>
                    <ul>
                        <li><a href="mailto:info@lebende.de">info@lebende.de</a></li>
                        <li><a href="#">Support Center</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 LebenDE. All rights reserved. | Made with ‚ù§Ô∏è for aspiring German citizens</p>
            </div>
        </div>
    </footer>

    <script>
        // Simple loading screen hide with fallback
        setTimeout(() => {
            const loader = document.querySelector('.loading-screen');
            if (loader) {
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 500);
            }
        }, 2000);
        
        // Scroll to quiz function
        function scrollToQuiz() {
            const quizSection = document.getElementById('quiz');
            if (quizSection) {
                quizSection.scrollIntoView({ behavior: 'smooth' });
                // Start the quiz if the global quiz object exists
                if (window.quiz) {
                    window.quiz.startQuiz();
                }
            }
        }

        // Dashboard functionality
        function loadDashboardData() {
            const dashboardData = JSON.parse(localStorage.getItem('lebenDE_dashboard') || '{}');
            
            // Update profile stats
            if (dashboardData.stats) {
                document.getElementById('profile-total-sessions').textContent = dashboardData.stats.totalExams || 0;
                document.getElementById('profile-study-time').textContent = Math.round((dashboardData.stats.totalExamTime || 0) / 60) + 'h';
                document.getElementById('profile-success-rate').textContent = dashboardData.stats.averageScore || 0 + '%';
            }
            
            // Update quick stats
            document.getElementById('total-questions-answered').textContent = 
                (dashboardData.examHistory || []).reduce((total, exam) => total + exam.totalQuestions, 0);
            
            if (dashboardData.stats && dashboardData.stats.totalExams > 0) {
                const avgTime = Math.round((dashboardData.stats.totalExamTime * 60) / dashboardData.stats.totalExams);
                document.getElementById('average-time').textContent = avgTime + 's';
                document.getElementById('best-streak').textContent = dashboardData.stats.bestScore + '%';
            }
            
            // Update progress
            if (dashboardData.examHistory && dashboardData.examHistory.length > 0) {
                const latestExam = dashboardData.examHistory[dashboardData.examHistory.length - 1];
                updateProgressCircle(latestExam.score);
                
                document.getElementById('dashboard-correct').textContent = latestExam.correctAnswers;
                document.getElementById('dashboard-incorrect').textContent = 
                    latestExam.totalQuestions - latestExam.correctAnswers;
                document.getElementById('dashboard-remaining').textContent = 
                    Math.max(0, 33 - latestExam.totalQuestions);
            }
            
            // Update recent activity
            updateRecentActivity(dashboardData.recentActivity || []);
            
            // Update exam history
            updateExamHistory(dashboardData.examHistory || []);
            
            // Update study streak
            updateStudyStreak(dashboardData);
        }

        function updateProgressCircle(percentage) {
            const circle = document.getElementById('dashboard-progress-circle');
            const text = document.getElementById('dashboard-progress-text');
            const circumference = 2 * Math.PI * 50; // radius = 50
            const offset = circumference - (percentage / 100) * circumference;
            
            circle.style.strokeDashoffset = offset;
            text.textContent = percentage + '%';
        }

        function updateRecentActivity(activities) {
            const container = document.getElementById('recent-activity');
            
            if (activities.length === 0) {
                container.innerHTML = `
                    <div class="activity-item empty">
                        <div class="activity-icon">üéØ</div>
                        <div class="activity-content">
                            <p>Start your first exam to see activity here!</p>
                            <span class="activity-time">No activity yet</span>
                        </div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = activities.slice(0, 5).map(activity => {
                const date = new Date(activity.date);
                const timeAgo = getTimeAgo(date);
                const icon = activity.passed ? '‚úÖ' : '‚ùå';
                const status = activity.passed ? 'Passed' : 'Failed';
                
                return `
                    <div class="activity-item">
                        <div class="activity-icon">${icon}</div>
                        <div class="activity-content">
                            <p>Exam ${status}: ${activity.score}% (${activity.duration} min)</p>
                            <span class="activity-time">${timeAgo}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateExamHistory(examHistory) {
            const container = document.getElementById('exam-history-list');
            
            if (examHistory.length === 0) {
                container.innerHTML = `
                    <div class="exam-history-empty">
                        <p>No exam attempts yet. Take your first exam simulation!</p>
                    </div>
                `;
                return;
            }
            
            const recentExams = examHistory.slice(0, 2).reverse();
            const hasMore = examHistory.length > 2;
            
            let historyHTML = recentExams.map(exam => {
                const date = new Date(exam.date);
                const formattedDate = date.toLocaleDateString('de-DE', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
                const formattedTime = date.toLocaleTimeString('de-DE', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const statusClass = exam.passed ? 'passed' : 'failed';
                const statusIcon = exam.passed ? '‚úÖ' : '‚ùå';
                const statusText = exam.passed ? 'BESTANDEN' : 'NICHT BESTANDEN';
                
                return `
                    <div class="exam-item ${statusClass}">
                        <div class="exam-status">
                            <span class="status-icon">${statusIcon}</span>
                            <span class="status-text">${statusText}</span>
                        </div>
                        <div class="exam-details">
                            <div class="exam-score">${exam.score}%</div>
                            <div class="exam-info">
                                <span>${exam.correctAnswers}/${exam.totalQuestions} korrekt</span>
                                <span>${exam.duration} Minuten</span>
                            </div>
                            <div class="exam-date">${formattedDate} ${formattedTime}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            if (hasMore) {
                historyHTML += `
                    <div class="view-all-exams">
                        <button class="view-all-btn" onclick="showAllExams()">
                            Alle ${examHistory.length} Pr√ºfungen anzeigen
                        </button>
                    </div>
                `;
            }
            
            container.innerHTML = historyHTML;
        }

        function showAllExams() {
            const dashboardData = JSON.parse(localStorage.getItem('lebenDE_dashboard') || '{}');
            const examHistory = dashboardData.examHistory || [];
            
            const allExamsHTML = `
                <div class="all-exams-modal" id="all-exams-modal">
                    <div class="modal-overlay" onclick="closeAllExams()"></div>
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>Alle Pr√ºfungsversuche (${examHistory.length})</h2>
                            <button class="close-btn" onclick="closeAllExams()" title="Schlie√üen">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="all-exams-list">
                                ${examHistory.reverse().map(exam => {
                                    const date = new Date(exam.date);
                                    const formattedDate = date.toLocaleDateString('de-DE', {
                                        day: '2-digit',
                                        month: '2-digit',
                                        year: 'numeric'
                                    });
                                    const formattedTime = date.toLocaleTimeString('de-DE', {
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    });
                                    
                                    const statusClass = exam.passed ? 'passed' : 'failed';
                                    const statusIcon = exam.passed ? '‚úÖ' : '‚ùå';
                                    const statusText = exam.passed ? 'BESTANDEN' : 'NICHT BESTANDEN';
                                    
                                    return `
                                        <div class="exam-item ${statusClass}">
                                            <div class="exam-status">
                                                <span class="status-icon">${statusIcon}</span>
                                                <span class="status-text">${statusText}</span>
                                            </div>
                                            <div class="exam-details">
                                                <div class="exam-score">${exam.score}%</div>
                                                <div class="exam-info">
                                                    <span>${exam.correctAnswers}/${exam.totalQuestions} korrekt</span>
                                                    <span>${exam.duration} Minuten</span>
                                                </div>
                                                <div class="exam-date">${formattedDate} ${formattedTime}</div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', allExamsHTML);
        }

        function closeAllExams() {
            const modal = document.getElementById('all-exams-modal');
            if (modal) {
                modal.remove();
            }
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / (1000 * 60));
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            if (days > 0) return `${days} day${days > 1 ? 's' : ''} ago`;
            if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
            return 'Just now';
        }

        // Bundesland functions
        function showBundeslandSelector() {
            document.getElementById('bundesland-modal').style.display = 'flex';
        }

        function closeBundeslandSelector() {
            document.getElementById('bundesland-modal').style.display = 'none';
        }

        function startBundeslandQuiz(bundeslandName) {
            // Map Bundesland names to their HTML files
            const bundeslandFiles = {
                'Baden-W√ºrttemberg': 'baden-wuerttemberg-quiz.html',
                'Bayern': 'bayern-quiz.html',
                'Berlin': 'berlin-quiz.html',
                'Brandenburg': 'brandenburg-quiz.html',
                'Bremen': 'bremen-quiz.html',
                'Hamburg': 'hamburg-quiz.html',
                'Hessen': 'hessen-quiz.html',
                'Mecklenburg-Vorpommern': 'mecklenburg-vorpommern-quiz.html',
                'Niedersachsen': 'niedersachsen-quiz.html',
                'Nordrhein-Westfalen': 'nordrhein-westfalen-quiz.html',
                'Rheinland-Pfalz': 'rheinland-pfalz-quiz.html',
                'Saarland': 'saarland-quiz.html',
                'Sachsen': 'sachsen-quiz.html',
                'Sachsen-Anhalt': 'sachsen-anhalt-quiz.html',
                'Schleswig-Holstein': 'schleswig-holstein-quiz.html',
                'Th√ºringen': 'thueringen-quiz.html'
            };
            
            const fileName = bundeslandFiles[bundeslandName];
            if (fileName) {
                window.location.href = fileName;
            } else {
                alert('Quiz f√ºr dieses Bundesland ist noch nicht verf√ºgbar.');
            }
            closeBundeslandSelector();
        }

        // Study Streak Functions
        function updateStudyStreak(dashboardData) {
            const currentStreak = calculateCurrentStreak(dashboardData);
            const bestStreak = calculateBestStreak(dashboardData);
            
            // Update UI elements
            document.getElementById('current-streak').textContent = currentStreak;
            document.getElementById('best-streak').textContent = bestStreak;
            
            // Update streak message
            updateStreakMessage(currentStreak);
            
            // Update streak calendar
            updateStreakCalendar(dashboardData);
        }
        
        function calculateCurrentStreak(dashboardData) {
            if (!dashboardData.examHistory && !dashboardData.bundeslandHistory && !dashboardData.practiceHistory) {
                return 0;
            }
            
            // Combine all study activities
            const allActivities = [];
            
            if (dashboardData.examHistory) {
                allActivities.push(...dashboardData.examHistory.map(exam => ({
                    date: exam.date,
                    timestamp: exam.timestamp || new Date(exam.date).toISOString()
                })));
            }
            
            if (dashboardData.bundeslandHistory) {
                allActivities.push(...dashboardData.bundeslandHistory.map(exam => ({
                    date: exam.date,
                    timestamp: exam.timestamp || new Date(exam.date).toISOString()
                })));
            }
            
            if (dashboardData.practiceHistory) {
                allActivities.push(...dashboardData.practiceHistory.map(practice => ({
                    date: practice.date,
                    timestamp: practice.timestamp || new Date(practice.date).toISOString()
                })));
            }
            
            if (allActivities.length === 0) return 0;
            
            // Sort by date (most recent first)
            allActivities.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            // Get unique study dates
            const studyDates = [...new Set(allActivities.map(activity => activity.date))];
            studyDates.sort((a, b) => new Date(b) - new Date(a));
            
            let streak = 0;
            const today = new Date().toLocaleDateString('de-DE');
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toLocaleDateString('de-DE');
            
            // Check if user studied today or yesterday
            if (studyDates.includes(today)) {
                streak = 1;
                let checkDate = new Date();
                checkDate.setDate(checkDate.getDate() - 1);
                
                // Count consecutive days backwards
                while (checkDate >= 0) {
                    const dateStr = checkDate.toLocaleDateString('de-DE');
                    if (studyDates.includes(dateStr)) {
                        streak++;
                        checkDate.setDate(checkDate.getDate() - 1);
                    } else {
                        break;
                    }
                }
            } else if (studyDates.includes(yesterdayStr)) {
                // User studied yesterday but not today - check if we should count streak
                streak = 1;
                let checkDate = new Date();
                checkDate.setDate(checkDate.getDate() - 2);
                
                while (checkDate >= 0) {
                    const dateStr = checkDate.toLocaleDateString('de-DE');
                    if (studyDates.includes(dateStr)) {
                        streak++;
                        checkDate.setDate(checkDate.getDate() - 1);
                    } else {
                        break;
                    }
                }
            }
            
            return streak;
        }
        
        function calculateBestStreak(dashboardData) {
            if (!dashboardData.examHistory && !dashboardData.bundeslandHistory && !dashboardData.practiceHistory) {
                return 0;
            }
            
            // Combine all study activities
            const allActivities = [];
            
            if (dashboardData.examHistory) {
                allActivities.push(...dashboardData.examHistory.map(exam => ({
                    date: exam.date,
                    timestamp: exam.timestamp || new Date(exam.date).toISOString()
                })));
            }
            
            if (dashboardData.bundeslandHistory) {
                allActivities.push(...dashboardData.bundeslandHistory.map(exam => ({
                    date: exam.date,
                    timestamp: exam.timestamp || new Date(exam.date).toISOString()
                })));
            }
            
            if (dashboardData.practiceHistory) {
                allActivities.push(...dashboardData.practiceHistory.map(practice => ({
                    date: practice.date,
                    timestamp: practice.timestamp || new Date(practice.date).toISOString()
                })));
            }
            
            if (allActivities.length === 0) return 0;
            
            // Get unique study dates and sort them
            const studyDates = [...new Set(allActivities.map(activity => activity.date))];
            studyDates.sort((a, b) => new Date(a) - new Date(b));
            
            let maxStreak = 0;
            let currentStreak = 0;
            let previousDate = null;
            
            for (let dateStr of studyDates) {
                const currentDate = new Date(dateStr.split('.').reverse().join('-')); // Convert DD.MM.YYYY to YYYY-MM-DD
                
                if (previousDate === null) {
                    currentStreak = 1;
                } else {
                    const daysDiff = Math.floor((currentDate - previousDate) / (1000 * 60 * 60 * 24));
                    
                    if (daysDiff === 1) {
                        // Consecutive day
                        currentStreak++;
                    } else {
                        // Gap in streak
                        maxStreak = Math.max(maxStreak, currentStreak);
                        currentStreak = 1;
                    }
                }
                
                previousDate = currentDate;
            }
            
            return Math.max(maxStreak, currentStreak);
        }
        
        function updateStreakMessage(streak) {
            const messageElement = document.getElementById('streak-message');
            
            if (streak === 0) {
                messageElement.textContent = "Start studying to build your streak! üéØ";
            } else if (streak === 1) {
                messageElement.textContent = "Great start! Keep it up tomorrow! üí™";
            } else if (streak < 7) {
                messageElement.textContent = `${streak} days strong! You're building momentum! üî•`;
            } else if (streak < 30) {
                messageElement.textContent = `Amazing ${streak}-day streak! You're on fire! üöÄ`;
            } else {
                messageElement.textContent = `Incredible ${streak}-day streak! You're unstoppable! ‚≠ê`;
            }
        }
        
        function updateStreakCalendar(dashboardData) {
            const calendarElement = document.getElementById('streak-calendar');
            
            // Combine all study activities
            const allActivities = [];
            
            if (dashboardData.examHistory) {
                allActivities.push(...dashboardData.examHistory.map(exam => exam.date));
            }
            
            if (dashboardData.bundeslandHistory) {
                allActivities.push(...dashboardData.bundeslandHistory.map(exam => exam.date));
            }
            
            const studyDates = [...new Set(allActivities)];
            
            // Generate last 7 days
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                last7Days.push({
                    date: date.toLocaleDateString('de-DE'),
                    day: date.getDate(),
                    studied: studyDates.includes(date.toLocaleDateString('de-DE'))
                });
            }
            
            // Generate calendar HTML
            calendarElement.innerHTML = last7Days.map(day => `
                <div class="calendar-day ${day.studied ? 'active' : ''}" title="${day.date}">
                    <span class="day-number">${day.day}</span>
                    <div class="day-dot"></div>
                </div>
            `).join('');
        }

        // Load dashboard data when page loads
        document.addEventListener('DOMContentLoaded', loadDashboardData);
    </script>
    <script src="script.js"></script>
</body>
</html>